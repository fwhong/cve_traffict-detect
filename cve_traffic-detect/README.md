# PKUCC CVEæµé‡æ£€æµ‹

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)



åŸºäºæœºå™¨å­¦ä¹ å’Œè§„åˆ™å¼•æ“çš„CVEæ¼æ´æµé‡æ£€æµ‹ç³»ç»Ÿï¼Œé›†æˆ4ä¸ªé˜¶æ®µçš„æ™ºèƒ½æ£€æµ‹æµç¨‹ã€‚

## ç‰¹æ€§

- **å››é˜¶æ®µæ£€æµ‹æµç¨‹**ï¼šè§„åˆ™åŒ¹é… â†’ MLå¢å¼º â†’ æœ¬åœ°éªŒè¯ â†’ LLMéªŒè¯
- **æœºå™¨å­¦ä¹ å¢å¼º**ï¼šåŸºäºFastTextçš„é«˜æ•ˆæ¨¡å‹ï¼ŒCPUå‹å¥½
-  **é›¶äººå·¥æ ‡æ³¨è®­ç»ƒ**ï¼šä»CVE POCè§„åˆ™è‡ªåŠ¨ç”Ÿæˆè®­ç»ƒæ•°æ®
-  **é«˜æ€§èƒ½å¤„ç†**ï¼šæ”¯æŒå¤§è§„æ¨¡æµé‡æ•°æ®å¤„ç†ï¼ˆ100K+è®°å½•ï¼‰
- **å®æ—¶è¾“å‡ºæ˜¾ç¤º**ï¼šå®æ—¶æŸ¥çœ‹æ£€æµ‹è¿›åº¦
- **è¯¯æŠ¥æ§åˆ¶**ï¼šå¯é…ç½®ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œç²¾ç¡®æ§åˆ¶è¯¯æŠ¥ç‡

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å®Œæ•´æµç¨‹](#å®Œæ•´æµç¨‹)
- [å•ç‹¬è„šæœ¬ä½¿ç”¨](#å•ç‹¬è„šæœ¬ä½¿ç”¨)
- [å®‰è£…](#å®‰è£…)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨è‡ªåŠ¨åŒ–æµç¨‹ï¼ˆæ¨èï¼‰

```bash
# å®Œæ•´æµç¨‹ï¼ˆ4ä¸ªé˜¶æ®µï¼‰
python run_cve_detection_pipeline.py

# å¿«é€ŸéªŒè¯æ¨¡å¼ï¼ˆåªéªŒè¯å·²æ£€æµ‹çš„CVEï¼‰
python run_cve_detection_pipeline.py --cve-only --skip-llm

# ä¸¥æ ¼æ¨¡å¼ï¼ˆå‡å°‘è¯¯æŠ¥ï¼‰
python run_cve_detection_pipeline.py --ml-threshold 0.999
```

### å•ç‹¬è¿è¡Œè„šæœ¬

```bash
# é˜¶æ®µ1: è§„åˆ™åŒ¹é…
python detect_cve_final.py

# é˜¶æ®µ2: MLå¢å¼ºï¼ˆéœ€è¦å…ˆè¿è¡Œé˜¶æ®µ1ï¼‰
python detect_cve_ml_enhance.py --mode predict --input-csv test_label.csv

# é˜¶æ®µ3: æœ¬åœ°éªŒè¯
python local_verify_cve.py

# é˜¶æ®µ4: LLMéªŒè¯
python llm_refine_verified.py
```

##  å®Œæ•´æµç¨‹

### æµç¨‹æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          PKUCC CVEæ£€æµ‹æµç¨‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  é˜¶æ®µ1: è§„åˆ™åŒ¹é…ç­›é€‰         â”‚
        â”‚  detect_cve_final.py       â”‚
        â”‚  è¾“å…¥: test_payload.json   â”‚
        â”‚  è¾“å‡º: test_label.csv      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  é˜¶æ®µ2: MLæ¨¡å‹å¢å¼º          â”‚
        â”‚  detect_cve_ml_enhance.py  â”‚
        â”‚  è¾“å…¥: test_label.csv      â”‚
        â”‚  è¾“å‡º: test_label_ml_      â”‚
        â”‚        enhanced.csv        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  é˜¶æ®µ3: æœ¬åœ°éªŒè¯            â”‚
        â”‚  local_verify_cve.py       â”‚
        â”‚  è¾“å…¥: test_label_ml_      â”‚
        â”‚        enhanced.csv        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  é˜¶æ®µ4: LLMè¾…åŠ©éªŒè¯         â”‚
        â”‚  llm_refine_verified.py    â”‚
        â”‚  æœ€ç»ˆç»“æœ                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬

**åŸºæœ¬ç”¨æ³•ï¼š**

```bash
python run_cve_detection_pipeline.py [OPTIONS]
```

**é€‰é¡¹è¯´æ˜ï¼š**

| é€‰é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--ml-threshold` | float | 0.998 | MLæ¨¡å‹ç½®ä¿¡åº¦é˜ˆå€¼ (0.0-1.0) |
| `--cve-only` | flag | False | åªéªŒè¯è§„åˆ™æ£€æµ‹çš„CVEï¼ˆå¿«é€Ÿæ¨¡å¼ï¼‰ |
| `--skip-llm` | flag | False | è·³è¿‡LLMéªŒè¯é˜¶æ®µ |

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```bash
# å®Œæ•´æµç¨‹ï¼ˆé»˜è®¤é…ç½®ï¼‰
python run_cve_detection_pipeline.py

# ä½¿ç”¨æä¸¥æ ¼é˜ˆå€¼ï¼ˆæœ€å°åŒ–è¯¯æŠ¥ï¼‰
python run_cve_detection_pipeline.py --ml-threshold 0.999

# å¿«é€ŸéªŒè¯æ¨¡å¼ï¼ˆ10å€é€Ÿåº¦ï¼‰
python run_cve_detection_pipeline.py --cve-only --skip-llm

# è·³è¿‡LLMé˜¶æ®µï¼ˆé€‚ç”¨äºLLMä¸å¯ç”¨æ—¶ï¼‰
python run_cve_detection_pipeline.py --skip-llm
```



## å•ç‹¬è„šæœ¬ä½¿ç”¨

### é˜¶æ®µ1: detect_cve_final.py

**åŠŸèƒ½**ï¼šä½¿ç”¨CVE YAMLè§„åˆ™è¿›è¡Œåˆæ­¥åŒ¹é…ç­›é€‰

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
python detect_cve_final.py
```

**è¾“å…¥æ–‡ä»¶ï¼š**
- `data/test_payload.json` - HTTPæµé‡æ•°æ®

**è¾“å‡ºæ–‡ä»¶ï¼š**
- `test_label.csv` - åˆæ­¥ç­›é€‰ç»“æœï¼ˆæ ¼å¼ï¼šid, cve_labelsï¼‰

**è¯´æ˜ï¼š**
- è‡ªåŠ¨ä»`data/test_payload.json`è¯»å–æµé‡
- åŒ¹é…CVE POCè§„åˆ™åº“
- è¾“å‡ºåŒ…å«CVEæ ‡ç­¾çš„è®°å½•

---

### é˜¶æ®µ2: detect_cve_ml_enhance.py

**åŠŸèƒ½**ï¼šä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹è¿›è¡Œå¢å¼ºæ£€æµ‹å’Œè¯¯æŠ¥è¿‡æ»¤

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
# è®­ç»ƒæ¨¡å¼ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
python detect_cve_ml_enhance.py \
    --mode train \
    --rules-dir ../datacon25/cve \
    --model-file cve_model.bin

# é¢„æµ‹æ¨¡å¼
python detect_cve_ml_enhance.py \
    --mode predict \
    --model-file cve_model.bin \
    --ml-threshold 0.998 \
    --input-csv test_label.csv \
    --payload-json data/test_payload.json \
    --output-csv test_label_ml_enhanced.csv

# è®­ç»ƒ+é¢„æµ‹ï¼ˆä¸€æ­¥åˆ°ä½ï¼‰
python detect_cve_ml_enhance.py \
    --mode both \
    --rules-dir ../datacon25/cve \
    --input-csv test_label.csv \
    --payload-json data/test_payload.json \
    --output-csv test_label_ml_enhanced.csv
```

**å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--mode` | æ˜¯ | both | æ¨¡å¼ï¼štrain/predict/both |
| `--rules-dir` | è®­ç»ƒæ—¶ | ../datacon25/cve | CVEè§„åˆ™ç›®å½• |
| `--input-csv` | é¢„æµ‹æ—¶ | test_label.csv | è¾“å…¥CSVæ–‡ä»¶ |
| `--payload-json` | é¢„æµ‹æ—¶ | data/test_payload.json | æµé‡æ•°æ® |
| `--output-csv` | é¢„æµ‹æ—¶ | test_label_ml_enhanced.csv | è¾“å‡ºæ–‡ä»¶ |
| `--model-file` | å¦ | cve_detection_model.bin | æ¨¡å‹æ–‡ä»¶è·¯å¾„ |
| `--ml-threshold` | å¦ | 0.95 | ç½®ä¿¡åº¦é˜ˆå€¼ |
| `--cve-only` | å¦ | False | åªå¤„ç†CVEè®°å½• |

**è¾“å…¥æ–‡ä»¶ï¼š**
- `test_label.csv` - é˜¶æ®µ1çš„è¾“å‡º
- `data/test_payload.json` - åŸå§‹æµé‡æ•°æ®
- `../datacon25/cve/*.yaml` - CVEè§„åˆ™ï¼ˆè®­ç»ƒæ—¶ï¼‰

**è¾“å‡ºæ–‡ä»¶ï¼š**
- `test_label_ml_enhanced.csv` - MLå¢å¼ºç»“æœ
- `cve_model.bin` - è®­ç»ƒçš„æ¨¡å‹æ–‡ä»¶
- `cve_training_data.txt` - è®­ç»ƒæ•°æ®

**é˜ˆå€¼é€‰æ‹©æŒ‡å—ï¼š**

| é˜ˆå€¼ | æ£€å‡ºé‡ | è¯¯æŠ¥ç‡ | ä½¿ç”¨åœºæ™¯ |
|------|--------|--------|---------|
| 0.999 | å°‘ | æä½ | ç”Ÿäº§ç¯å¢ƒ |
| 0.998 | ä¸­ç­‰ | ä½ | **æ¨è** |
| 0.99 | è¾ƒå¤š | ä¸­ç­‰ | ç ”ç©¶åˆ†æ |
| 0.95 | å¾ˆå¤š | é«˜ | å…¨é¢æ‰«æ |

**è¾“å‡ºæ ¼å¼ï¼š**

```csv
id,cve_labels
0,
1,
9,CVE-2018-8719
10,CVE-2019-1234
```

---

### é˜¶æ®µ3: local_verify_cve.py

**åŠŸèƒ½**ï¼šæœ¬åœ°éªŒè¯CVEæ£€æµ‹ç»“æœ

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
python local_verify_cve.py
```

**è¾“å…¥æ–‡ä»¶ï¼š**
- `test_label_ml_enhanced.csv` - é˜¶æ®µ2çš„è¾“å‡º

**è¯´æ˜ï¼š**
- å¯¹MLå¢å¼ºåçš„ç»“æœè¿›è¡Œæœ¬åœ°éªŒè¯
- éªŒè¯é€»è¾‘æ ¹æ®å…·ä½“å®ç°

---

### é˜¶æ®µ4: llm_refine_verified.py

**åŠŸèƒ½**ï¼šä½¿ç”¨LLMè¿›è¡Œæœ€ç»ˆéªŒè¯å’Œç²¾ç‚¼

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
python llm_refine_verified.py
```

**è¾“å…¥æ–‡ä»¶ï¼š**
- é˜¶æ®µ3çš„è¾“å‡ºæ–‡ä»¶

**è¯´æ˜ï¼š**
- ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹è¿›è¡Œæœ€ç»ˆéªŒè¯
- éœ€è¦é…ç½®APIå¯†é’¥

## å®‰è£…

### ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- CPUï¼ˆæ— éœ€GPUï¼‰
- å†…å­˜ï¼šå»ºè®®4GB+

### ä¾èµ–å®‰è£…

```bash
# å®‰è£…æ ¸å¿ƒä¾èµ–
pip install fasttext pyyaml

```

### æ•°æ®å‡†å¤‡

```bash
# ç¡®ä¿æ•°æ®æ–‡ä»¶å­˜åœ¨
data/
â”œâ”€â”€ test_payload.json      # æµ‹è¯•æµé‡æ•°æ®
â””â”€â”€ train.json             # è®­ç»ƒæµé‡æ•°æ®ï¼ˆå¯é€‰ï¼‰

# CVEè§„åˆ™åº“ï¼ˆç”¨äºè®­ç»ƒï¼‰
../datacon25/cve/          # CVE YAMLè§„åˆ™ç›®å½•
```

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ run_cve_detection_pipeline.py  # è‡ªåŠ¨åŒ–æµç¨‹è„šæœ¬ â­
â”œâ”€â”€ detect_cve_final.py            # é˜¶æ®µ1: è§„åˆ™åŒ¹é…
â”œâ”€â”€ detect_cve_ml_enhance.py       # é˜¶æ®µ2: MLå¢å¼º
â”œâ”€â”€ local_verify_cve.py            # é˜¶æ®µ3: æœ¬åœ°éªŒè¯
â”œâ”€â”€ llm_refine_verified.py         # é˜¶æ®µ4: LLMéªŒè¯
â”œâ”€â”€ README.md                      # æœ¬æ–‡æ¡£
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ test_payload.json          # æµ‹è¯•æµé‡æ•°æ®
â”‚   â”œâ”€â”€ train.json                 # è®­ç»ƒæµé‡æ•°æ®
â”‚   â””â”€â”€ test_label.csv             # æ ‡æ³¨æ•°æ®
â””â”€â”€ output/                        # è¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
    â”œâ”€â”€ test_label.csv             # é˜¶æ®µ1è¾“å‡º
    â”œâ”€â”€ test_label_ml_enhanced.csv # é˜¶æ®µ2è¾“å‡º
    â””â”€â”€ cve_model.bin              # è®­ç»ƒæ¨¡å‹
```

## é…ç½®è¯´æ˜

### MLæ¨¡å‹é…ç½®

åœ¨ `detect_cve_ml_enhance.py` ä¸­å¯ä»¥è°ƒæ•´ï¼š

```python
# æ¨¡å‹å‚æ•°
lr=0.1          # å­¦ä¹ ç‡
dim=100         # è¯å‘é‡ç»´åº¦
epoch=25        # è®­ç»ƒè½®æ•°
wordNgrams=2    # N-gramé•¿åº¦
```

### è§„åˆ™åº“è·¯å¾„

ä¿®æ”¹ `run_cve_detection_pipeline.py` ä¸­çš„è§„åˆ™ç›®å½•ï¼š

```python
--rules-dir ../datacon25/cve  # ä¿®æ”¹ä¸ºå®é™…è·¯å¾„
```



---

**å¿«é€Ÿå¼€å§‹å‘½ä»¤ï¼š**

```bash
# ä¸€é”®è¿è¡Œå®Œæ•´æµç¨‹
python run_cve_detection_pipeline.py

# æŸ¥çœ‹å¸®åŠ©
python run_cve_detection_pipeline.py --help
```
